## 📌 Case Study #6 - Clique Bait

## ✔️ 4. Campaigns Analysis

## Generate a table that has 1 single row for every unique visit_id record and has the following columns:

````sql
select 
	distinct u.user_id,
	e.visit_id,
	min(e.event_time) as visit_start_time,
	sum(case 
	   		when ei.event_name='Page View' then 1 else 0 end ) as page_views,
	sum(case 
	   		when ei.event_name='Add to Cart' then 1 else 0 end ) as cart_adds,	
	sum(case 
	   		when ei.event_name='Purchase' then 1 else 0 end ) as purchase,
	ci.campaign_name,		
	sum(case 
	   		when ei.event_name='Ad Impression' then 1 else 0 end ) as impression,
	sum(case 
	   		when ei.event_name='Ad Click' then 1 else 0 end ) as click,	
	string_agg(case 
			  	when ph.product_id is not null and ei.event_name='Add to Cart' then ph.page_name else null end,
			  ', ' order by e.sequence_number) as cart_products 	
from users as u
left join events as e 
	on e.cookie_id=u.cookie_id
left join event_identifier as ei 
	on ei.event_type=e.event_type
left join page_hierarchy as ph
	on ph.page_id=e.page_id
left join campaign_identifier as ci
	on e.event_time between ci.start_date and ci.end_date
		group by 1,2,7
````
